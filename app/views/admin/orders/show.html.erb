<div class="container">
 <h2 class="my-5 text-center">注文履歴詳細</h2>
  <div class="row justify-content-center">
   <div class="col-xs-12">
      <table class="table table-hover table-bordered">
       <thead>
        <tr><th>購入者</th><td><%= @order.customer.family_name %><%= @order.customer.first_name %></td></tr>
        <tr><th>注文日</th><td><%= @order.created_at.strftime('%Y/%m/%d') %></td></tr>
        <tr><th>発送先</th><td><%= @order.address %></td></tr>
        <tr><th>支払方法</th><td><%= @order.payment_method %></td></tr>

        <%= form_with model: @order, url: admin_order_path, local:true do |f| %>
        <tr>
          <th>注文ステータス</th>
          <td><%= f.select :status, :name, Order.statuses.values.to_a %></td>
          <td><%= f.submit "更新", class: "btn btn-success" %></td>
        <% end %>
        </tr>
       </thead>
      </table>
    </div>
  </div>

  <div class="row justify-content-center">
    <div class="col-xs-8">
      <table class="table table-hover table-bordered">
        <thead class="thead-light">
          <tr>
            <th>商品名</th>
            <th>単価（税込）</th>
            <th>数量</th>
            <th>小計</th>
            <th>製作ステータス</th>
          </tr>
        </thead>
        <tbody>
          <% @cart_items.each do |cart| %>
          <tr>
            <td><%= cart.sweet.name %></td>
            <td><%= cart.sweet.sub_price.to_s(:delimited) %></td>
            <td><%= cart.sweet.amount %></td>
            <td><%= (cart.sweet.sub_price.to_i * cart.amount.to_i).to_s(:delimited) %></td>
            <% @sum += (cart.sweet.sub_price.to_i * cart.amount.to_i) %>
            <td>
              <%= form_with model: @order_sweet, url: admin_order_sweet_path(order_sweet.id), local:true do |f| %>
                <%= f.select :making_status, :name, OrderSweet.statuses.values.to_a %>
                <%= f.submit "更新" ,class: "btn btn-success" %>
              <% end %>
            </td>
          </tr>
          <% end %>
        </tbody>
      </table>

      <div class="col-xs-3 off-set-1">
       <table class="table table-hover table-bordered">
          <tr>
            <th>商品合計</th>
            <td class="text-right col-xs-5"><%= (@order.shipping - @order.total_price).to_s(:delimited) %>円</td>
          </tr>
          <tr>
            <th>送料</th>
            <td class="text-right col-xs-5"><%= @order.shopping.to_s(:delimited) %>円</td>
          </tr>
          <tr>
            <th>請求金額合計</th>
          　<td class="text-right col-xs-5"><%= @order.total_price.to_s(:delimited) %>円</td>
          </tr>
          <tr>
            <th></th>
            <td class="text-right col-xs-5"><%= link_to "注文履歴へ戻る", admin_order_path, class:"btn btn-secondary"%></td>
          </tr>
       </table>
      </div>
    </div>
  </div>
</div>
